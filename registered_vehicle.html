<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vehicle Registration</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #004899;
            --secondary-color: #f8f9fa;
            --accent-color: #4CAF50;
            --text-color: #333;
            --light-text: #777;
            --border-color: #e0e0e0;
            --white: #ffffff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .header {
            background-color: var(--primary-color);
            color: var(--white);
            padding: 15px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-text {
            font-size: 22px;
            font-weight: 600;
        }
        
        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 20px;
        }
        
        .registration-form {
            background-color: var(--white);
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 30px;
        }
        
        .form-title {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 24px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--primary-color);
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 16px;
        }
        
        .form-control:focus {
            border-color: var(--primary-color);
            outline: none;
        }
        
        .file-upload {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .file-upload-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .file-upload-item label {
            flex: 1;
        }
        
        .btn {
            padding: 12px 24px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #00367a;
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
        }
        
        .error-message {
            color: #dc3545;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        .success-message {
            color: #28a745;
            font-size: 16px;
            margin: 20px 0;
            text-align: center;
            display: none;
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo-container">
            <div class="logo-text">SmartPark Vehicle Registration</div>
        </div>
    </header>

    <div class="container">
        <div class="registration-form">
            <h1 class="form-title">Register New Vehicle</h1>
            
            <div id="successMessage" class="success-message"></div>
            
            <form id="vehicleForm">
                <div class="form-grid">
                    <!-- Vehicle Information -->
                    <div class="form-group">
                        <label for="vehicleType">Vehicle Type</label>
                        <select id="vehicleType" class="form-control" required>
                            <option value="">Select Type</option>
                            <option value="car">Car</option>
                            <option value="suv">SUV</option>
                            <option value="truck">Truck</option>
                            <option value="motorcycle">Motorcycle</option>
                        </select>
                        <div id="vehicleTypeError" class="error-message">Please select vehicle type</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="manufacturer">Manufacturer (Make)</label>
                        <input type="text" id="manufacturer" class="form-control" required>
                        <div id="manufacturerError" class="error-message">Please enter manufacturer</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="model">Model</label>
                        <input type="text" id="model" class="form-control" required>
                        <div id="modelError" class="error-message">Please enter model</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="year">Year</label>
                        <input type="number" id="year" class="form-control" min="1900" max="2099" required>
                        <div id="yearError" class="error-message">Please enter valid year</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="color">Color</label>
                        <input type="text" id="color" class="form-control" required>
                        <div id="colorError" class="error-message">Please enter color</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="seatingCapacity">Seating Capacity</label>
                        <input type="number" id="seatingCapacity" class="form-control" min="1" required>
                        <div id="seatingError" class="error-message">Please enter seating capacity</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="engineNumber">Engine Number</label>
                        <input type="text" id="engineNumber" class="form-control" required>
                        <div id="engineError" class="error-message">Please enter engine number</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="chassisNumber">Chassis Number</label>
                        <input type="text" id="chassisNumber" class="form-control" required>
                        <div id="chassisError" class="error-message">Please enter chassis number</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="fuelType">Fuel Type</label>
                        <select id="fuelType" class="form-control" required>
                            <option value="">Select Fuel Type</option>
                            <option value="petrol">Petrol</option>
                            <option value="diesel">Diesel</option>
                            <option value="electric">Electric</option>
                            <option value="hybrid">Hybrid</option>
                        </select>
                        <div id="fuelTypeError" class="error-message">Please select fuel type</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="purchaseDate">Purchase Date</label>
                        <input type="date" id="purchaseDate" class="form-control" required>
                        <div id="purchaseDateError" class="error-message">Please select purchase date</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="specialNumber">Special Number (if any)</label>
                        <input type="text" id="specialNumber" class="form-control">
                    </div>
                </div>
                
                <!-- Document Uploads -->
                <h2 style="margin: 30px 0 15px 0; color: var(--primary-color);">Required Documents</h2>
                
                <div class="form-grid">
                    <div class="form-group file-upload">
                        <label>Aadhar Card Copy</label>
                        <div class="file-upload-item">
                            <input type="file" id="aadharDoc" accept=".pdf,.jpg,.jpeg,.png" required>
                            <div id="aadharError" class="error-message">Please upload Aadhar copy</div>
                        </div>
                    </div>
                    
                    <div class="form-group file-upload">
                        <label>Insurance Document</label>
                        <div class="file-upload-item">
                            <input type="file" id="insuranceDoc" accept=".pdf,.jpg,.jpeg,.png" required>
                            <div id="insuranceError" class="error-message">Please upload insurance document</div>
                        </div>
                    </div>
                    
                    <div class="form-group file-upload">
                        <label>Purchase Invoice</label>
                        <div class="file-upload-item">
                            <input type="file" id="purchaseDoc" accept=".pdf,.jpg,.jpeg,.png" required>
                            <div id="purchaseDocError" class="error-message">Please upload purchase invoice</div>
                        </div>
                    </div>
                    
                    <div class="form-group file-upload">
                        <label>License Copy</label>
                        <div class="file-upload-item">
                            <input type="file" id="licenseDoc" accept=".pdf,.jpg,.jpeg,.png" required>
                            <div id="licenseError" class="error-message">Please upload license copy</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn" onclick="window.location.href='registered_vehicle.html'">Cancel</button>
                    <button type="submit" class="btn">Register Vehicle</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('vehicleForm');
            const successMessage = document.getElementById('successMessage');
            
            // Validate form on submit
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Reset error messages
                document.querySelectorAll('.error-message').forEach(el => {
                    el.style.display = 'none';
                });
                
                // Validate all required fields
                let isValid = true;
                
                const requiredFields = [
                    'vehicleType', 'manufacturer', 'model', 'year', 
                    'color', 'seatingCapacity', 'engineNumber', 
                    'chassisNumber', 'fuelType', 'purchaseDate'
                ];
                
                requiredFields.forEach(field => {
                    const element = document.getElementById(field);
                    if (!element.value) {
                        document.getElementById(`${field}Error`).style.display = 'block';
                        isValid = false;
                    }
                });
                
                // Validate file uploads
                const requiredFiles = ['aadharDoc', 'insuranceDoc', 'purchaseDoc', 'licenseDoc'];
                requiredFiles.forEach(file => {
                    const element = document.getElementById(file);
                    if (!element.files || element.files.length === 0) {
                        document.getElementById(`${file}Error`).style.display = 'block';
                        isValid = false;
                    }
                });
                
                if (!isValid) {
                    return;
                }
                
                try {
                    // Get user data from localStorage
                    const userData = JSON.parse(localStorage.getItem('userData'));
                    if (!userData || !userData.id) {
                        throw new Error('User not logged in');
                    }
                    
                    // Create FormData for file upload
                    const formData = new FormData();
                    formData.append('userId', userData.id);
                    formData.append('vehicleType', document.getElementById('vehicleType').value);
                    formData.append('manufacturer', document.getElementById('manufacturer').value);
                    formData.append('model', document.getElementById('model').value);
                    formData.append('seatingCapacity', document.getElementById('seatingCapacity').value);
                    formData.append('color', document.getElementById('color').value);
                    formData.append('engineNumber', document.getElementById('engineNumber').value);
                    formData.append('chassisNumber', document.getElementById('chassisNumber').value);
                    formData.append('fuelType', document.getElementById('fuelType').value);
                    formData.append('purchaseDate', document.getElementById('purchaseDate').value);
                    
                    const specialNumber = document.getElementById('specialNumber').value;
                    if (specialNumber) {
                        formData.append('specialNumber', specialNumber);
                    }
                    
                    // Append files
                    formData.append('aadharDoc', document.getElementById('aadharDoc').files[0]);
                    formData.append('insuranceDoc', document.getElementById('insuranceDoc').files[0]);
                    formData.append('purchaseDoc', document.getElementById('purchaseDoc').files[0]);
                    formData.append('licenseDoc', document.getElementById('licenseDoc').files[0]);
                    
                    // Submit to server
                    const response = await fetch('http://localhost:5000/register-vehicle', {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'Authorization': userData.id.toString()
                        }
                    });
                    
                    const data = await response.json();
                    
                    if (!response.ok) {
                        throw new Error(data.message || 'Registration failed');
                    }
                    
                    // Show success message
                    successMessage.textContent = 'Vehicle registered successfully! Redirecting...';
                    successMessage.style.display = 'block';
                    
                    // Reset form
                    form.reset();
                    
                    // Redirect after 2 seconds
                    setTimeout(() => {
                        window.location.href = 'registered_vehicle.html';
                    }, 2000);
                    
                } catch (error) {
                    console.error('Registration error:', error);
                    alert(error.message || 'Failed to register vehicle. Please try again.');
                }
            });
        });
    </script>
</body>
</html>